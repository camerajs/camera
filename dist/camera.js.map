{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/camera.ts","src/events/load.ts","src/lib/browser.ts","src/lib/setCamera.ts","src/lib/utils.ts","src/preferences.ts"],"names":[],"mappings":"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","file":"camera.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import {loadEvent} from \"./events/load\";\nimport {preferences} from \"./preferences\";\nimport {utils} from \"./lib/utils\";\nimport {browser} from \"./lib/browser\";\nimport {setCamera} from \"./lib/setCamera\";\nimport {upload} from \"./lib/upload\";\nclass cameraInitializer {\n    constructor() {\n        cameraInitializer.ready();\n    }\n\n    static async ready() {\n        let loadEventInstance = new loadEvent();\n        //https://github.com/Microsoft/TypeScript/wiki/What's-new-in-TypeScript#downlevel-async-functions\n\n        await loadEventInstance.eventListener();\n\n        if (!preferences.isHttps) {\n            utils.log(\"HTTPS required\", \"warn\");\n        }\n\n        if (setCamera.listCameraAndMicrophones() == undefined) {\n            utils.log(\"No camera input found on this device.\", 'warn');\n        }\n\n        if (!browser.checkBrowserSupport()) {\n            utils.log(\"Your browser does not support camera\", \"warn\");\n        }\n\n        if (browser.checkBrowserSupport() && setCamera.listCameraAndMicrophones()) {\n            /*If user browser is supporting camera and already has at least one active camera, then we are safe to call\n             setCamera()\n             */\n            new setCamera()\n        }\n\n    }\n}\n\nnew cameraInitializer();\n","import {eventInterface} from \"./interface\";\nimport {utils} from \"../lib/utils\";\nimport {browser} from \"../lib/browser\";\nimport {preferences} from \"../preferences\";\n\nexport class loadEvent implements eventInterface {\n\n    eventListener() {\n        /**\n         * This method will be called inside the this.eventCallback method using a async function which means\n         *   the method (this.eventCallback) will wait for the answer from evenListener (current method).\n         */\n        return new Promise<void>(resolve => {\n            window.addEventListener(\"load\", () => {\n                /**\n                 * resolve() will return to result to the async function in its call stack, and will let the function\n                 *   continue\n                 */\n                this.eventCallback();\n                resolve();\n            });\n        });\n    }\n\n    eventCallback() {\n        preferences.isHttps = utils.isHttps();\n        preferences.isMobile = browser.checkMobile(); //If true, means the user browser is a mobile browser\n    }\n\n}\n\n\n\n\n","import {preferences} from \"../preferences\";\nexport class browser {\n\n    static checkBrowserSupport() {\n        /**\n         * This method will check if the user browser is supporting HTML5 camera API or not\n         * The result of the !!(navigator.getUserMedia...) will be true or false\n         * Learn more: https://www.html5rocks.com/en/tutorials/getusermedia/intro/\n         * Learn more: https://hacks.mozilla.org/2013/02/cross-browser-camera-capture-with-getusermediawebrtc/\n         * Solution for old navigator object properties: http://stackoverflow.com/a/13642033/3176270\n         **/\n        let nav = <any>navigator;\n        preferences.browserCameraSupport = !!(nav.getUserMedia || nav.webkitGetUserMedia ||\n        nav.mozGetUserMedia || nav.msGetUserMedia);\n        return preferences.browserCameraSupport;\n    }\n\n    static checkMobile(): boolean {\n        //Return true if the user browser is a mobile browser:\n        let check = false;\n        (function (a) {\n            if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n        })(navigator.userAgent || navigator.vendor);\n        return check;\n    }\n}\n","import {utils} from \"./utils\";\nexport class setCamera {\n    constructor() {\n        let cameraTags: NodeList = setCamera.getCameraTags(); //List of founded camera tag elements\n\n        if (cameraTags.length) {\n            //if any camera tag found:\n            this.createCameraView(cameraTags);\n        }\n    }\n\n    private static getCameraTags() {\n        /**\n         * getCameraTags() returns list of camera tags found on the HTML page.\n         * This should be a method, because we will have more things to check for a camera-tag,\n         * like some settings & configurations from the camera tag attributes\n         **/\n        return <NodeList>document.querySelectorAll('[data-camera]');\n    }\n\n    protected createCameraView(cameraTags: any) {\n        //Check the number of user camera/audio inputs which are installed into user device (if 0 or undefined , it means no camera found):\n        setCamera.listCameraAndMicrophones();\n\n\n        /*loop through founded camera tags, and insert video tag, canvas and menu into them\n         (video tag will let us stream camera output, canvas will capture the picture)*/\n        for (let i = 0; i < cameraTags.length; i++) {\n            let currentCameraTag: HTMLElement = cameraTags[i];\n            currentCameraTag.className = 'camerajs-element';\n            currentCameraTag.appendChild(setCamera._createVideoElement(i));\n            currentCameraTag.appendChild(setCamera._createCanvasElement(i));\n            currentCameraTag.appendChild(setCamera._createCameraMenu());\n\n            //Stream the camera output by the video tag:\n            let videoElement: HTMLVideoElement = <HTMLVideoElement>document.getElementById('camerajs-' + i);\n            navigator.mediaDevices.getUserMedia({video: true}).then(function (stream) {\n                videoElement.src = window.URL.createObjectURL(stream);\n                videoElement.play();\n            });\n\n            //Initialize the canvas to put the captured photo into it:\n            let canvasElement: HTMLCanvasElement = <HTMLCanvasElement>document.getElementById('camerajs-canvas-' + i);\n            let canvasContext: any = canvasElement.getContext('2d');\n\n            //Mirroring the canvas\n            canvasContext.translate(640, 0);\n            canvasContext.scale(-1, 1);\n\n            //Capture photo:\n            currentCameraTag.querySelector(\".camerajs-menu>a\").addEventListener(\"click\", function () {\n                canvasContext.drawImage(videoElement, 0, 0, 640, 480); //Draw the captured photo on canvas\n            });\n        }\n    }\n\n    private static _createVideoElement(elementIndex: number) {\n        /*\n         * Inside the createCameraView method, we will need to make something that user can see the output of the camera\n         *  we need to put a video, canvas tag, and camera main menu (the capture and change camera from rear to front\n         *  will be inside menu, also filter and effects) - This method is just for video element and will let user to see\n         *  camera output\n         * */\n        let videoTag: HTMLVideoElement = document.createElement(\"video\");\n        videoTag.id = \"camerajs-\" + elementIndex;\n        videoTag.setAttribute('width', '640');\n        videoTag.setAttribute('height', '480');\n        videoTag.setAttribute(\"autoplay\", \"true\");\n        return videoTag;\n    }\n\n    private static _createCanvasElement(elementIndex: number) {\n        /*\n         * Inside the createCameraView method, we will need to make something that user can see the output of the camera\n         *  we need to put a video, canvas tag, and camera main menu (the capture and change camera from rear to front\n         *  will be inside menu, also filter and effects) - Canvas element will be used when we capture a picture\n         * */\n        let canvasTag: HTMLCanvasElement = document.createElement(\"canvas\");\n        canvasTag.id = \"camerajs-canvas-\" + elementIndex;\n        canvasTag.setAttribute('width', '640');\n        canvasTag.setAttribute('height', '480');\n        return canvasTag;\n    }\n\n    private static _createCameraMenu() {\n        /*\n         * Inside the createCameraView method, we will need to make something that user can see the output of the camera\n         *  we need to put a video, canvas tag, and camera main menu (the capture and change camera from rear to front\n         *  will be inside menu, also filter and effects) - The menu of the camera (capture, change camera, etc buttons)\n         * */\n        //<div class=\"camerajs-menu\"><a>' + svgIconCapture + '</a></div>';\n        let menuDivTag: HTMLDivElement = document.createElement(\"div\");\n        menuDivTag.className = \"camerajs-menu\";\n\n        //create the capture button (the svgIconCapture is a capture icon):\n        let svgIconCapture: any = '<?xml version=\"1.0\" ?><svg style=\"enable-background:new 0 0 24 24;\" version=\"1.1\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><g id=\"info\"/><g id=\"icons\"><path d=\"M19,7h-0.4c-0.4,0-0.7-0.2-0.9-0.6l-1.2-2.3c-0.3-0.7-1-1.1-1.8-1.1H9.2C8.5,3,7.8,3.4,7.4,4.1L6.3,6.4   C6.1,6.8,5.8,7,5.4,7H5c-2.2,0-4,1.8-4,4v6c0,2.2,1.8,4,4,4h14c2.2,0,4-1.8,4-4v-6C23,8.8,21.2,7,19,7z M12,17c-2.2,0-4-1.8-4-4   c0-2.2,1.8-4,4-4s4,1.8,4,4C16,15.2,14.2,17,12,17z\" id=\"photo\"/></g></svg>';\n        let captureButton: HTMLAnchorElement = document.createElement(\"a\");\n        captureButton.innerHTML = svgIconCapture;\n\n        menuDivTag.appendChild(captureButton);\n\n        return menuDivTag;\n    }\n\n    static listCameraAndMicrophones() {\n        let inputs: any = {};\n        //This function will return the number of founded cameras and microphones on user's device.\n        navigator.mediaDevices.enumerateDevices()\n            .then(function (devices: any) {\n                devices.forEach(function (device: any) {\n                    // inputs[device.kind][deviceCounter]['id'] =   device.deviceId;\n                    //inputs[device.kind][deviceCounter]['label'] =   device.label;\n                    if (!inputs[device.kind]) {\n                        /*\n                         * //Initialize the array for, otherwise the .push will returns\n                         * \"Error: Cannot read property 'push' of undefined in [null].\"\n                         **/\n                        inputs[device.kind] = [];\n                    }\n                    inputs[device.kind].push({label: device.label, deviceId: device.deviceId});\n                });\n\n                //List of video inputs are accessible in return: inputs['videoinput']\n                return inputs;\n\n            }).catch(function (err: any) {\n            if (err.length) {\n                utils.log(err.name + \": \" + err.message, \"warn\");\n            }\n            return false;\n        });\n    }\n}","import {preferences} from \"../preferences\";\n\nexport class utils {\n    static log(message: string, type: string): void {\n        message = 'Camera.js: ' + message;\n        if (preferences.debug) {\n            switch (type) {\n                case 'warn':\n                    console.warn(message);\n                    break;\n                case 'info':\n                    console.info(message);\n                    break;\n                default:\n                    console.log(message);\n            }\n        }\n    }\n\n    static isHttps() {\n        return 'https:' == document.location.protocol;\n    }\n\n    /**\n     * http://stackoverflow.com/questions/5717093\n     * @param url\n     * @returns {boolean}\n     */\n    static validUrl(url: string) {\n        let regexp: RegExp = /(ftp|http|https):\\/\\/(\\w+:?\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@\\-\\/]))?/;\n        return regexp.test(url);\n    }\n}","export class preferences{\n    static isHttps:boolean = false;\n    static isMobile:boolean = false;\n    static debug:boolean = true;\n    static browserCameraSupport:boolean = false;\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2FtZXJhLnRzIiwic3JjL2V2ZW50cy9sb2FkLnRzIiwic3JjL2xpYi9icm93c2VyLnRzIiwic3JjL2xpYi9zZXRDYW1lcmEudHMiLCJzcmMvbGliL3V0aWxzLnRzIiwic3JjL3ByZWZlcmVuY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ0FBLHFCQUF3QztBQUN4Qyw0QkFBMEM7QUFDMUMsc0JBQWtDO0FBQ2xDLHdCQUFzQztBQUN0QywwQkFBMEM7QUFFMUM7QUFDSTtBQUNJLEFBQWlCLDBCQUFDLEFBQUssQUFBRSxBQUFDLEFBQzlCO0FBQUM7QUFFWSxzQkFBSyxRQUFsQjs7Z0JBQ1EsQUFBaUI7Ozs7NENBQUcsSUFBSSxPQUFTLEFBQUU7QUFDdkMsQUFBaUc7QUFFakcsNkNBQU0sQUFBaUIsa0JBQUMsQUFBYSxBQUFFOztBQUZ2QyxBQUFpRztBQUVqRywyQkFBdUMsQUFBQztBQUV4QyxBQUFFLEFBQUMsNEJBQUMsQ0FBQyxjQUFXLFlBQUMsQUFBTyxBQUFDLFNBQUMsQUFBQztBQUN2QixvQ0FBSyxNQUFDLEFBQUcsSUFBQyxBQUFnQixrQkFBRSxBQUFNLEFBQUMsQUFBQyxBQUN4QztBQUFDO0FBRUQsQUFBRSxBQUFDLDRCQUFDLFlBQVMsVUFBQyxBQUF3QixBQUFFLDhCQUFJLEFBQVMsQUFBQyxXQUFDLEFBQUM7QUFDcEQsb0NBQUssTUFBQyxBQUFHLElBQUMsQUFBdUMseUNBQUUsQUFBTSxBQUFDLEFBQUMsQUFDL0Q7QUFBQztBQUVELEFBQUUsQUFBQyw0QkFBQyxDQUFDLFVBQU8sUUFBQyxBQUFtQixBQUFFLEFBQUMsdUJBQUMsQUFBQztBQUNqQyxvQ0FBSyxNQUFD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QUM1QjtBQUFDO0FBQ0wsV0FBQSxBQUFDO0FBOUJELEFBOEJDO0FBOUJZLGdCQUFLOzs7OztBQ0ZsQjtBQUFBLDJCQUtBLENBQUM7QUFBRCxXQUFBLEFBQUM7QUFMRCxBQUtDO0FBSlUsWUFBTyxVQUFXLEFBQUssQUFBQztBQUN4QixZQUFRLFdBQVcsQUFBSyxBQUFDO0FBQ3pCLFlBQUssUUFBVyxBQUFJLEFBQUM7QUFDckIsWUFBb0IsdUJBQVcsQUFBSyxBQUFDO0FBSm5DLHNCQUFXIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB7bG9hZEV2ZW50fSBmcm9tIFwiLi9ldmVudHMvbG9hZFwiO1xuaW1wb3J0IHtwcmVmZXJlbmNlc30gZnJvbSBcIi4vcHJlZmVyZW5jZXNcIjtcbmltcG9ydCB7dXRpbHN9IGZyb20gXCIuL2xpYi91dGlsc1wiO1xuaW1wb3J0IHticm93c2VyfSBmcm9tIFwiLi9saWIvYnJvd3NlclwiO1xuaW1wb3J0IHtzZXRDYW1lcmF9IGZyb20gXCIuL2xpYi9zZXRDYW1lcmFcIjtcbmltcG9ydCB7dXBsb2FkfSBmcm9tIFwiLi9saWIvdXBsb2FkXCI7XG5jbGFzcyBjYW1lcmFJbml0aWFsaXplciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNhbWVyYUluaXRpYWxpemVyLnJlYWR5KCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGFzeW5jIHJlYWR5KCkge1xuICAgICAgICBsZXQgbG9hZEV2ZW50SW5zdGFuY2UgPSBuZXcgbG9hZEV2ZW50KCk7XG4gICAgICAgIC8vaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L3dpa2kvV2hhdCdzLW5ldy1pbi1UeXBlU2NyaXB0I2Rvd25sZXZlbC1hc3luYy1mdW5jdGlvbnNcblxuICAgICAgICBhd2FpdCBsb2FkRXZlbnRJbnN0YW5jZS5ldmVudExpc3RlbmVyKCk7XG5cbiAgICAgICAgaWYgKCFwcmVmZXJlbmNlcy5pc0h0dHBzKSB7XG4gICAgICAgICAgICB1dGlscy5sb2coXCJIVFRQUyByZXF1aXJlZFwiLCBcIndhcm5cIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2V0Q2FtZXJhLmxpc3RDYW1lcmFBbmRNaWNyb3Bob25lcygpID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdXRpbHMubG9nKFwiTm8gY2FtZXJhIGlucHV0IGZvdW5kIG9uIHRoaXMgZGV2aWNlLlwiLCAnd2FybicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFicm93c2VyLmNoZWNrQnJvd3NlclN1cHBvcnQoKSkge1xuICAgICAgICAgICAgdXRpbHMubG9nKFwiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgY2FtZXJhXCIsIFwid2FyblwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChicm93c2VyLmNoZWNrQnJvd3NlclN1cHBvcnQoKSAmJiBzZXRDYW1lcmEubGlzdENhbWVyYUFuZE1pY3JvcGhvbmVzKCkpIHtcbiAgICAgICAgICAgIC8qSWYgdXNlciBicm93c2VyIGlzIHN1cHBvcnRpbmcgY2FtZXJhIGFuZCBhbHJlYWR5IGhhcyBhdCBsZWFzdCBvbmUgYWN0aXZlIGNhbWVyYSwgdGhlbiB3ZSBhcmUgc2FmZSB0byBjYWxsXG4gICAgICAgICAgICAgc2V0Q2FtZXJhKClcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbmV3IHNldENhbWVyYSgpXG4gICAgICAgIH1cblxuICAgIH1cbn1cblxubmV3IGNhbWVyYUluaXRpYWxpemVyKCk7XG4iLCJpbXBvcnQge2V2ZW50SW50ZXJmYWNlfSBmcm9tIFwiLi9pbnRlcmZhY2VcIjtcbmltcG9ydCB7dXRpbHN9IGZyb20gXCIuLi9saWIvdXRpbHNcIjtcbmltcG9ydCB7YnJvd3Nlcn0gZnJvbSBcIi4uL2xpYi9icm93c2VyXCI7XG5pbXBvcnQge3ByZWZlcmVuY2VzfSBmcm9tIFwiLi4vcHJlZmVyZW5jZXNcIjtcblxuZXhwb3J0IGNsYXNzIGxvYWRFdmVudCBpbXBsZW1lbnRzIGV2ZW50SW50ZXJmYWNlIHtcblxuICAgIGV2ZW50TGlzdGVuZXIoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBpbnNpZGUgdGhlIHRoaXMuZXZlbnRDYWxsYmFjayBtZXRob2QgdXNpbmcgYSBhc3luYyBmdW5jdGlvbiB3aGljaCBtZWFuc1xuICAgICAgICAgKiAgIHRoZSBtZXRob2QgKHRoaXMuZXZlbnRDYWxsYmFjaykgd2lsbCB3YWl0IGZvciB0aGUgYW5zd2VyIGZyb20gZXZlbkxpc3RlbmVyIChjdXJyZW50IG1ldGhvZCkuXG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4ocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHJlc29sdmUoKSB3aWxsIHJldHVybiB0byByZXN1bHQgdG8gdGhlIGFzeW5jIGZ1bmN0aW9uIGluIGl0cyBjYWxsIHN0YWNrLCBhbmQgd2lsbCBsZXQgdGhlIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICogICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBldmVudENhbGxiYWNrKCkge1xuICAgICAgICBwcmVmZXJlbmNlcy5pc0h0dHBzID0gdXRpbHMuaXNIdHRwcygpO1xuICAgICAgICBwcmVmZXJlbmNlcy5pc01vYmlsZSA9IGJyb3dzZXIuY2hlY2tNb2JpbGUoKTsgLy9JZiB0cnVlLCBtZWFucyB0aGUgdXNlciBicm93c2VyIGlzIGEgbW9iaWxlIGJyb3dzZXJcbiAgICB9XG5cbn1cblxuXG5cblxuIiwiaW1wb3J0IHtwcmVmZXJlbmNlc30gZnJvbSBcIi4uL3ByZWZlcmVuY2VzXCI7XG5leHBvcnQgY2xhc3MgYnJvd3NlciB7XG5cbiAgICBzdGF0aWMgY2hlY2tCcm93c2VyU3VwcG9ydCgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgY2hlY2sgaWYgdGhlIHVzZXIgYnJvd3NlciBpcyBzdXBwb3J0aW5nIEhUTUw1IGNhbWVyYSBBUEkgb3Igbm90XG4gICAgICAgICAqIFRoZSByZXN1bHQgb2YgdGhlICEhKG5hdmlnYXRvci5nZXRVc2VyTWVkaWEuLi4pIHdpbGwgYmUgdHJ1ZSBvciBmYWxzZVxuICAgICAgICAgKiBMZWFybiBtb3JlOiBodHRwczovL3d3dy5odG1sNXJvY2tzLmNvbS9lbi90dXRvcmlhbHMvZ2V0dXNlcm1lZGlhL2ludHJvL1xuICAgICAgICAgKiBMZWFybiBtb3JlOiBodHRwczovL2hhY2tzLm1vemlsbGEub3JnLzIwMTMvMDIvY3Jvc3MtYnJvd3Nlci1jYW1lcmEtY2FwdHVyZS13aXRoLWdldHVzZXJtZWRpYXdlYnJ0Yy9cbiAgICAgICAgICogU29sdXRpb24gZm9yIG9sZCBuYXZpZ2F0b3Igb2JqZWN0IHByb3BlcnRpZXM6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzEzNjQyMDMzLzMxNzYyNzBcbiAgICAgICAgICoqL1xuICAgICAgICBsZXQgbmF2ID0gPGFueT5uYXZpZ2F0b3I7XG4gICAgICAgIHByZWZlcmVuY2VzLmJyb3dzZXJDYW1lcmFTdXBwb3J0ID0gISEobmF2LmdldFVzZXJNZWRpYSB8fCBuYXYud2Via2l0R2V0VXNlck1lZGlhIHx8XG4gICAgICAgIG5hdi5tb3pHZXRVc2VyTWVkaWEgfHwgbmF2Lm1zR2V0VXNlck1lZGlhKTtcbiAgICAgICAgcmV0dXJuIHByZWZlcmVuY2VzLmJyb3dzZXJDYW1lcmFTdXBwb3J0O1xuICAgIH1cblxuICAgIHN0YXRpYyBjaGVja01vYmlsZSgpOiBib29sZWFuIHtcbiAgICAgICAgLy9SZXR1cm4gdHJ1ZSBpZiB0aGUgdXNlciBicm93c2VyIGlzIGEgbW9iaWxlIGJyb3dzZXI6XG4gICAgICAgIGxldCBjaGVjayA9IGZhbHNlO1xuICAgICAgICAoZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgIGlmICgvKGFuZHJvaWR8YmJcXGQrfG1lZWdvKS4rbW9iaWxlfGF2YW50Z298YmFkYVxcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXFwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXFwuKGJyb3dzZXJ8bGluayl8dm9kYWZvbmV8d2FwfHdpbmRvd3MgY2V8eGRhfHhpaW5vL2kudGVzdChhKSB8fCAvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298c1xcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcXC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcXC0obnx1KXxjNTVcXC98Y2FwaXxjY3dhfGNkbVxcLXxjZWxsfGNodG18Y2xkY3xjbWRcXC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGNcXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcXC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2ZcXC01fGdcXC1tb3xnbyhcXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkXFwtKG18cHx0KXxoZWlcXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1xcLWN8aHQoYyhcXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXFwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFxcLXxcXC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XFwvKXxrbG9ufGtwdCB8a3djXFwtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcXC8oa3xsfHUpfDUwfDU0fFxcLVthLXddKXxsaWJ3fGx5bnh8bTFcXC13fG0zZ2F8bTUwXFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVxcLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFxcLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pXFwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcXC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cXC0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHRcXC1nfHFhXFwtYXxxYygwN3wxMnwyMXwzMnw2MHxcXC1bMi03XXxpXFwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVxcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFxcLXxvb3xwXFwtKXxzZGtcXC98c2UoYyhcXC18MHwxKXw0N3xtY3xuZHxyaSl8c2doXFwtfHNoYXJ8c2llKFxcLXxtKXxza1xcLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aFxcLXx2XFwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXFwtfHRkZ1xcLXx0ZWwoaXxtKXx0aW1cXC18dFxcLW1vfHRvKHBsfHNoKXx0cyg3MHxtXFwtfG0zfG01KXx0eFxcLTl8dXAoXFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfFxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXFwtfHlvdXJ8emV0b3x6dGVcXC0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlO1xuICAgICAgICB9KShuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IpO1xuICAgICAgICByZXR1cm4gY2hlY2s7XG4gICAgfVxufVxuIiwiaW1wb3J0IHt1dGlsc30gZnJvbSBcIi4vdXRpbHNcIjtcbmV4cG9ydCBjbGFzcyBzZXRDYW1lcmEge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBsZXQgY2FtZXJhVGFnczogTm9kZUxpc3QgPSBzZXRDYW1lcmEuZ2V0Q2FtZXJhVGFncygpOyAvL0xpc3Qgb2YgZm91bmRlZCBjYW1lcmEgdGFnIGVsZW1lbnRzXG5cbiAgICAgICAgaWYgKGNhbWVyYVRhZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAvL2lmIGFueSBjYW1lcmEgdGFnIGZvdW5kOlxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDYW1lcmFWaWV3KGNhbWVyYVRhZ3MpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2V0Q2FtZXJhVGFncygpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGdldENhbWVyYVRhZ3MoKSByZXR1cm5zIGxpc3Qgb2YgY2FtZXJhIHRhZ3MgZm91bmQgb24gdGhlIEhUTUwgcGFnZS5cbiAgICAgICAgICogVGhpcyBzaG91bGQgYmUgYSBtZXRob2QsIGJlY2F1c2Ugd2Ugd2lsbCBoYXZlIG1vcmUgdGhpbmdzIHRvIGNoZWNrIGZvciBhIGNhbWVyYS10YWcsXG4gICAgICAgICAqIGxpa2Ugc29tZSBzZXR0aW5ncyAmIGNvbmZpZ3VyYXRpb25zIGZyb20gdGhlIGNhbWVyYSB0YWcgYXR0cmlidXRlc1xuICAgICAgICAgKiovXG4gICAgICAgIHJldHVybiA8Tm9kZUxpc3Q+ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtY2FtZXJhXScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBjcmVhdGVDYW1lcmFWaWV3KGNhbWVyYVRhZ3M6IGFueSkge1xuICAgICAgICAvL0NoZWNrIHRoZSBudW1iZXIgb2YgdXNlciBjYW1lcmEvYXVkaW8gaW5wdXRzIHdoaWNoIGFyZSBpbnN0YWxsZWQgaW50byB1c2VyIGRldmljZSAoaWYgMCBvciB1bmRlZmluZWQgLCBpdCBtZWFucyBubyBjYW1lcmEgZm91bmQpOlxuICAgICAgICBzZXRDYW1lcmEubGlzdENhbWVyYUFuZE1pY3JvcGhvbmVzKCk7XG5cblxuICAgICAgICAvKmxvb3AgdGhyb3VnaCBmb3VuZGVkIGNhbWVyYSB0YWdzLCBhbmQgaW5zZXJ0IHZpZGVvIHRhZywgY2FudmFzIGFuZCBtZW51IGludG8gdGhlbVxuICAgICAgICAgKHZpZGVvIHRhZyB3aWxsIGxldCB1cyBzdHJlYW0gY2FtZXJhIG91dHB1dCwgY2FudmFzIHdpbGwgY2FwdHVyZSB0aGUgcGljdHVyZSkqL1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbWVyYVRhZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBjdXJyZW50Q2FtZXJhVGFnOiBIVE1MRWxlbWVudCA9IGNhbWVyYVRhZ3NbaV07XG4gICAgICAgICAgICBjdXJyZW50Q2FtZXJhVGFnLmNsYXNzTmFtZSA9ICdjYW1lcmFqcy1lbGVtZW50JztcbiAgICAgICAgICAgIGN1cnJlbnRDYW1lcmFUYWcuYXBwZW5kQ2hpbGQoc2V0Q2FtZXJhLl9jcmVhdGVWaWRlb0VsZW1lbnQoaSkpO1xuICAgICAgICAgICAgY3VycmVudENhbWVyYVRhZy5hcHBlbmRDaGlsZChzZXRDYW1lcmEuX2NyZWF0ZUNhbnZhc0VsZW1lbnQoaSkpO1xuICAgICAgICAgICAgY3VycmVudENhbWVyYVRhZy5hcHBlbmRDaGlsZChzZXRDYW1lcmEuX2NyZWF0ZUNhbWVyYU1lbnUoKSk7XG5cbiAgICAgICAgICAgIC8vU3RyZWFtIHRoZSBjYW1lcmEgb3V0cHV0IGJ5IHRoZSB2aWRlbyB0YWc6XG4gICAgICAgICAgICBsZXQgdmlkZW9FbGVtZW50OiBIVE1MVmlkZW9FbGVtZW50ID0gPEhUTUxWaWRlb0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbWVyYWpzLScgKyBpKTtcbiAgICAgICAgICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHt2aWRlbzogdHJ1ZX0pLnRoZW4oZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAgICAgICAgIHZpZGVvRWxlbWVudC5zcmMgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pO1xuICAgICAgICAgICAgICAgIHZpZGVvRWxlbWVudC5wbGF5KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9Jbml0aWFsaXplIHRoZSBjYW52YXMgdG8gcHV0IHRoZSBjYXB0dXJlZCBwaG90byBpbnRvIGl0OlxuICAgICAgICAgICAgbGV0IGNhbnZhc0VsZW1lbnQ6IEhUTUxDYW52YXNFbGVtZW50ID0gPEhUTUxDYW52YXNFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW1lcmFqcy1jYW52YXMtJyArIGkpO1xuICAgICAgICAgICAgbGV0IGNhbnZhc0NvbnRleHQ6IGFueSA9IGNhbnZhc0VsZW1lbnQuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICAgICAgLy9NaXJyb3JpbmcgdGhlIGNhbnZhc1xuICAgICAgICAgICAgY2FudmFzQ29udGV4dC50cmFuc2xhdGUoNjQwLCAwKTtcbiAgICAgICAgICAgIGNhbnZhc0NvbnRleHQuc2NhbGUoLTEsIDEpO1xuXG4gICAgICAgICAgICAvL0NhcHR1cmUgcGhvdG86XG4gICAgICAgICAgICBjdXJyZW50Q2FtZXJhVGFnLnF1ZXJ5U2VsZWN0b3IoXCIuY2FtZXJhanMtbWVudT5hXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2FudmFzQ29udGV4dC5kcmF3SW1hZ2UodmlkZW9FbGVtZW50LCAwLCAwLCA2NDAsIDQ4MCk7IC8vRHJhdyB0aGUgY2FwdHVyZWQgcGhvdG8gb24gY2FudmFzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIF9jcmVhdGVWaWRlb0VsZW1lbnQoZWxlbWVudEluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgLypcbiAgICAgICAgICogSW5zaWRlIHRoZSBjcmVhdGVDYW1lcmFWaWV3IG1ldGhvZCwgd2Ugd2lsbCBuZWVkIHRvIG1ha2Ugc29tZXRoaW5nIHRoYXQgdXNlciBjYW4gc2VlIHRoZSBvdXRwdXQgb2YgdGhlIGNhbWVyYVxuICAgICAgICAgKiAgd2UgbmVlZCB0byBwdXQgYSB2aWRlbywgY2FudmFzIHRhZywgYW5kIGNhbWVyYSBtYWluIG1lbnUgKHRoZSBjYXB0dXJlIGFuZCBjaGFuZ2UgY2FtZXJhIGZyb20gcmVhciB0byBmcm9udFxuICAgICAgICAgKiAgd2lsbCBiZSBpbnNpZGUgbWVudSwgYWxzbyBmaWx0ZXIgYW5kIGVmZmVjdHMpIC0gVGhpcyBtZXRob2QgaXMganVzdCBmb3IgdmlkZW8gZWxlbWVudCBhbmQgd2lsbCBsZXQgdXNlciB0byBzZWVcbiAgICAgICAgICogIGNhbWVyYSBvdXRwdXRcbiAgICAgICAgICogKi9cbiAgICAgICAgbGV0IHZpZGVvVGFnOiBIVE1MVmlkZW9FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpO1xuICAgICAgICB2aWRlb1RhZy5pZCA9IFwiY2FtZXJhanMtXCIgKyBlbGVtZW50SW5kZXg7XG4gICAgICAgIHZpZGVvVGFnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnNjQwJyk7XG4gICAgICAgIHZpZGVvVGFnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzQ4MCcpO1xuICAgICAgICB2aWRlb1RhZy5zZXRBdHRyaWJ1dGUoXCJhdXRvcGxheVwiLCBcInRydWVcIik7XG4gICAgICAgIHJldHVybiB2aWRlb1RhZztcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBfY3JlYXRlQ2FudmFzRWxlbWVudChlbGVtZW50SW5kZXg6IG51bWJlcikge1xuICAgICAgICAvKlxuICAgICAgICAgKiBJbnNpZGUgdGhlIGNyZWF0ZUNhbWVyYVZpZXcgbWV0aG9kLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzb21ldGhpbmcgdGhhdCB1c2VyIGNhbiBzZWUgdGhlIG91dHB1dCBvZiB0aGUgY2FtZXJhXG4gICAgICAgICAqICB3ZSBuZWVkIHRvIHB1dCBhIHZpZGVvLCBjYW52YXMgdGFnLCBhbmQgY2FtZXJhIG1haW4gbWVudSAodGhlIGNhcHR1cmUgYW5kIGNoYW5nZSBjYW1lcmEgZnJvbSByZWFyIHRvIGZyb250XG4gICAgICAgICAqICB3aWxsIGJlIGluc2lkZSBtZW51LCBhbHNvIGZpbHRlciBhbmQgZWZmZWN0cykgLSBDYW52YXMgZWxlbWVudCB3aWxsIGJlIHVzZWQgd2hlbiB3ZSBjYXB0dXJlIGEgcGljdHVyZVxuICAgICAgICAgKiAqL1xuICAgICAgICBsZXQgY2FudmFzVGFnOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgIGNhbnZhc1RhZy5pZCA9IFwiY2FtZXJhanMtY2FudmFzLVwiICsgZWxlbWVudEluZGV4O1xuICAgICAgICBjYW52YXNUYWcuc2V0QXR0cmlidXRlKCd3aWR0aCcsICc2NDAnKTtcbiAgICAgICAgY2FudmFzVGFnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzQ4MCcpO1xuICAgICAgICByZXR1cm4gY2FudmFzVGFnO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIF9jcmVhdGVDYW1lcmFNZW51KCkge1xuICAgICAgICAvKlxuICAgICAgICAgKiBJbnNpZGUgdGhlIGNyZWF0ZUNhbWVyYVZpZXcgbWV0aG9kLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzb21ldGhpbmcgdGhhdCB1c2VyIGNhbiBzZWUgdGhlIG91dHB1dCBvZiB0aGUgY2FtZXJhXG4gICAgICAgICAqICB3ZSBuZWVkIHRvIHB1dCBhIHZpZGVvLCBjYW52YXMgdGFnLCBhbmQgY2FtZXJhIG1haW4gbWVudSAodGhlIGNhcHR1cmUgYW5kIGNoYW5nZSBjYW1lcmEgZnJvbSByZWFyIHRvIGZyb250XG4gICAgICAgICAqICB3aWxsIGJlIGluc2lkZSBtZW51LCBhbHNvIGZpbHRlciBhbmQgZWZmZWN0cykgLSBUaGUgbWVudSBvZiB0aGUgY2FtZXJhIChjYXB0dXJlLCBjaGFuZ2UgY2FtZXJhLCBldGMgYnV0dG9ucylcbiAgICAgICAgICogKi9cbiAgICAgICAgLy88ZGl2IGNsYXNzPVwiY2FtZXJhanMtbWVudVwiPjxhPicgKyBzdmdJY29uQ2FwdHVyZSArICc8L2E+PC9kaXY+JztcbiAgICAgICAgbGV0IG1lbnVEaXZUYWc6IEhUTUxEaXZFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgbWVudURpdlRhZy5jbGFzc05hbWUgPSBcImNhbWVyYWpzLW1lbnVcIjtcblxuICAgICAgICAvL2NyZWF0ZSB0aGUgY2FwdHVyZSBidXR0b24gKHRoZSBzdmdJY29uQ2FwdHVyZSBpcyBhIGNhcHR1cmUgaWNvbik6XG4gICAgICAgIGxldCBzdmdJY29uQ2FwdHVyZTogYW55ID0gJzw/eG1sIHZlcnNpb249XCIxLjBcIiA/Pjxzdmcgc3R5bGU9XCJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI0IDI0O1wiIHZlcnNpb249XCIxLjFcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCI+PGcgaWQ9XCJpbmZvXCIvPjxnIGlkPVwiaWNvbnNcIj48cGF0aCBkPVwiTTE5LDdoLTAuNGMtMC40LDAtMC43LTAuMi0wLjktMC42bC0xLjItMi4zYy0wLjMtMC43LTEtMS4xLTEuOC0xLjFIOS4yQzguNSwzLDcuOCwzLjQsNy40LDQuMUw2LjMsNi40ICAgQzYuMSw2LjgsNS44LDcsNS40LDdINWMtMi4yLDAtNCwxLjgtNCw0djZjMCwyLjIsMS44LDQsNCw0aDE0YzIuMiwwLDQtMS44LDQtNHYtNkMyMyw4LjgsMjEuMiw3LDE5LDd6IE0xMiwxN2MtMi4yLDAtNC0xLjgtNC00ICAgYzAtMi4yLDEuOC00LDQtNHM0LDEuOCw0LDRDMTYsMTUuMiwxNC4yLDE3LDEyLDE3elwiIGlkPVwicGhvdG9cIi8+PC9nPjwvc3ZnPic7XG4gICAgICAgIGxldCBjYXB0dXJlQnV0dG9uOiBIVE1MQW5jaG9yRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICBjYXB0dXJlQnV0dG9uLmlubmVySFRNTCA9IHN2Z0ljb25DYXB0dXJlO1xuXG4gICAgICAgIG1lbnVEaXZUYWcuYXBwZW5kQ2hpbGQoY2FwdHVyZUJ1dHRvbik7XG5cbiAgICAgICAgcmV0dXJuIG1lbnVEaXZUYWc7XG4gICAgfVxuXG4gICAgc3RhdGljIGxpc3RDYW1lcmFBbmRNaWNyb3Bob25lcygpIHtcbiAgICAgICAgbGV0IGlucHV0czogYW55ID0ge307XG4gICAgICAgIC8vVGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiB0aGUgbnVtYmVyIG9mIGZvdW5kZWQgY2FtZXJhcyBhbmQgbWljcm9waG9uZXMgb24gdXNlcidzIGRldmljZS5cbiAgICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkZXZpY2VzOiBhbnkpIHtcbiAgICAgICAgICAgICAgICBkZXZpY2VzLmZvckVhY2goZnVuY3Rpb24gKGRldmljZTogYW55KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlucHV0c1tkZXZpY2Uua2luZF1bZGV2aWNlQ291bnRlcl1bJ2lkJ10gPSAgIGRldmljZS5kZXZpY2VJZDtcbiAgICAgICAgICAgICAgICAgICAgLy9pbnB1dHNbZGV2aWNlLmtpbmRdW2RldmljZUNvdW50ZXJdWydsYWJlbCddID0gICBkZXZpY2UubGFiZWw7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5wdXRzW2RldmljZS5raW5kXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIC8vSW5pdGlhbGl6ZSB0aGUgYXJyYXkgZm9yLCBvdGhlcndpc2UgdGhlIC5wdXNoIHdpbGwgcmV0dXJuc1xuICAgICAgICAgICAgICAgICAgICAgICAgICogXCJFcnJvcjogQ2Fubm90IHJlYWQgcHJvcGVydHkgJ3B1c2gnIG9mIHVuZGVmaW5lZCBpbiBbbnVsbF0uXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAqKi9cbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0c1tkZXZpY2Uua2luZF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbnB1dHNbZGV2aWNlLmtpbmRdLnB1c2goe2xhYmVsOiBkZXZpY2UubGFiZWwsIGRldmljZUlkOiBkZXZpY2UuZGV2aWNlSWR9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vTGlzdCBvZiB2aWRlbyBpbnB1dHMgYXJlIGFjY2Vzc2libGUgaW4gcmV0dXJuOiBpbnB1dHNbJ3ZpZGVvaW5wdXQnXVxuICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dHM7XG5cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnI6IGFueSkge1xuICAgICAgICAgICAgaWYgKGVyci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB1dGlscy5sb2coZXJyLm5hbWUgKyBcIjogXCIgKyBlcnIubWVzc2FnZSwgXCJ3YXJuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG59IiwiaW1wb3J0IHtwcmVmZXJlbmNlc30gZnJvbSBcIi4uL3ByZWZlcmVuY2VzXCI7XG5cbmV4cG9ydCBjbGFzcyB1dGlscyB7XG4gICAgc3RhdGljIGxvZyhtZXNzYWdlOiBzdHJpbmcsIHR5cGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBtZXNzYWdlID0gJ0NhbWVyYS5qczogJyArIG1lc3NhZ2U7XG4gICAgICAgIGlmIChwcmVmZXJlbmNlcy5kZWJ1Zykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnd2Fybic6XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnaW5mbyc6XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgaXNIdHRwcygpIHtcbiAgICAgICAgcmV0dXJuICdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTcxNzA5M1xuICAgICAqIEBwYXJhbSB1cmxcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBzdGF0aWMgdmFsaWRVcmwodXJsOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHJlZ2V4cDogUmVnRXhwID0gLyhmdHB8aHR0cHxodHRwcyk6XFwvXFwvKFxcdys6P1xcdypAKT8oXFxTKykoOlswLTldKyk/KFxcL3xcXC8oW1xcdyMhOi4/Kz0mJUBcXC1cXC9dKSk/LztcbiAgICAgICAgcmV0dXJuIHJlZ2V4cC50ZXN0KHVybCk7XG4gICAgfVxufSIsImV4cG9ydCBjbGFzcyBwcmVmZXJlbmNlc3tcbiAgICBzdGF0aWMgaXNIdHRwczpib29sZWFuID0gZmFsc2U7XG4gICAgc3RhdGljIGlzTW9iaWxlOmJvb2xlYW4gPSBmYWxzZTtcbiAgICBzdGF0aWMgZGVidWc6Ym9vbGVhbiA9IHRydWU7XG4gICAgc3RhdGljIGJyb3dzZXJDYW1lcmFTdXBwb3J0OmJvb2xlYW4gPSBmYWxzZTtcbn1cbiJdfQ=="}